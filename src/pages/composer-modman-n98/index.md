---
title: Процесс разработки модулей для magento1
date: "2016-01-13T22:12:03.284Z"
---

Немного истории.
> На заре разработки magento-модулей в нашей команде в тот момент когда мы начали использовать composer для установки magento-модулей в
> проекты, появилась задача хранить код модуля при разработке отдельно от ядра magento. Дело в том что magento 1.x обладает довольно сложной
> структурой и заставляет мешать ваши собственные файлы расширений с тысячами файлов и директорий ядра magento. Некоторое время использовали
> для решения этой задачи - composer, хотя он нужен несколько для других вещей. Спрашивал у коллег бэкендеров как они решают эту задачу -
> ответили «по старинке обычным копированием в проект».  Нет это не наш путь - искать при выносе в композер все соответствующие файлы, а если
> файл инициализации модуля забыли добавить?

<script type="text/javascript" src="https://asciinema.org/a/19464.js" id="asciicast-19464" data-theme="tango" async></script>

<p>Задача: сгенерировать скелетон модуля и оформить его в виде композер модуля и чтобы эти действия не занимали много времени.</p>

<p>Как мы делали до того как узнали про modman. Была идея установки модуля и симлинков через композер - это долго и в последствии отказались от этого, composer update происходит слишком долго. Нужен инструмент упрощающий работу с симлинками. Так был найден modman.</p>

Для чего нужен <a href="https://github.com/colinmollenhour/modman">modman</a>?

<p>Modman позволяет сохранять файлы ваших magento-модулей отдельно от тысяч файлов ядра magento. При этом можно держать файлы модуля в отдельном репозитории системы контроля версий, это сопутствующая фича.</p>

<p>Начало работы</p>

<ol>
 <li>Заходим в директорий с magento сайтом и делаем modman init, создается служебная директорий в которую в последствии будут устанавливаться модули .modman (по аналогии с composer - там vendor)</li>
 <li>Обязательно нужно разрешить использование симлинков в админке <pre>System > Configuration > Advanced > Developer</pre></li>
 <li>Один из вариантов делаем <pre>modman link path/to/module</pre> (есть ещё <pre>modman clone url</pre> - указывается путь до репозитория)</li>
 <li>Чтобы можно было сделать <pre>modman link</pre> или <pre>modman clone</pre> модуль должен содержать файл маппинга. Маппинг указывается для каждого файла модуля - по принципу source -> destination.</li>
</ol>

<p>Один из плюсов - полная интеграция modman и composer. Композер умеет читать маппинг модман-файла, то есть маппинг находится в одном файле и можно использовать две технологии одновременно. </p>

<p>Теперь самое интересное - как же автоматизировать все рутинные операции? Тут нам помогут <a href="https://github.com/netz98/n98-magerun">n98-magerun</a> и <a href="https://github.com/mhauri/generate-modman">generate-modman</a>.

<p>Как n98magerun и generate-modman можно использовать применительно к modman? В n98magerun есть генератор модуля, но тут необходимо добавить магические ключи:</p>

```bash
n98-magerun dev:module:create --add-all --modman --add-composer --author-name="Dmitry Schegolihin" --author-email="d.sch@gmail.com" Shegolihin Generated local
```

<p>Командой будет создан скелетон модуля Generated с стандартной структурой magento-модуля, предподготовленным файлом конфигурации composer.json, c неймспейсом Shegolihin в local code pull и соответствующим файлом маппинга modman. Ключи --author-name и --author-email добавят параметры в composer.json</p>

<p>Структура каталогов получилась не совсем стандартной из-за директории src. Давайте её уберем: переносим содержимое src в текущюю папку, удаляем src и вызываем генератор автоматического маппинга generate-modman. В итоге должна получиться структура:</p>

<p>Допустим в процессе работы понадобилось замапить ещё одну директорию - не забываем перегенирить modman файл маппинга и починить все симлинки modman repair. Из документации:</p>

```bash
repair - rebuild all modman-created symlinks (no updates performed)
```

<p>Можно набрать в консоли команду modman - выдаст документацию, в которой можно быстро найти нужный ключ.</p>

<p>C наступающий Старым Новым Годом! ;-)</p>
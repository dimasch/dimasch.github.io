{"data":{"site":{"siteMetadata":{"title":"About web performance and sites with energy low.","author":"Dmitry Schegolihin"}},"markdownRemark":{"id":"14589374-4c58-5b67-9bce-8545df333f7a","excerpt":"Sometimes is required to identify the limitations of performance and bottlenecks of an application in order to make the most efficient use…","html":"<p>Sometimes is required to identify the limitations of performance and bottlenecks of an application in order to make the most efficient use of its resources. Detect a <code class=\"language-text\">memory leaks</code> for you apps may be critical for production environments. Let’s look at how to identify such moments using <code class=\"language-text\">Yandex Tank</code> benchmark.</p>\n<h2>Setup</h2>\n<p>In first we create directory and config file:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">mkdir ~/loadtest &amp;&amp; touch load.yaml</code></pre></div>\n<p>Add next configuration to <code class=\"language-text\">load.yaml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">phantom:\n  address: 192.168.20.117:3000 # [Target&#39;s address]:[target&#39;s port]\n  uris:\n    - /\n  load_profile:\n    load_type: rps # schedule load by defining requests per second\n    schedule: line(1, 10, 10m) # starting from 1rps growing linearly to 10rps during 10 minutes\nconsole:\n  enabled: true # enable console output\ntelegraf:\n  enabled: false # let&#39;s disable telegraf monitoring for the first time</code></pre></div>\n<p>Important sections <code class=\"language-text\">address</code>, <code class=\"language-text\">uris</code> and <code class=\"language-text\">schedule</code>. For <code class=\"language-text\">address</code> key need setup <code class=\"language-text\">host</code> and <code class=\"language-text\">port</code> for you tested application.</p>\n<p>Then we can start <code class=\"language-text\">Yandex Tank</code> with using prepared Docker image (if you use macosx - need install <code class=\"language-text\">Docker for Mac</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker run -v $(pwd):/var/loadtest -v $SSH_AUTH_SOCK:/ssh-agent -e SSH_AUTH_SOCK=/ssh-agent -v $HOME/.ssh:/root/.ssh --net host -it direvius/yandex-tank</code></pre></div>\n<p>And see output:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9a6bb2364ca5623003b30d2c722f06c/875ba/console-output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 42.43723208818126%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABS0lEQVQY021Q2WrDMBD0V8RNHMmHJFuSj/q+ZPmAEPKQD2geS0oo+f8P6NpQKKTDPGjZnZ1ZGdmGKIqapum6blB6nhbVqb7roVRKaa27tsumXN1UpjMZciZYnMbQNdq27fseJqZpqqoqEVEuU058aruH/RvANM2duZNc5nEe+DwIAtd17Q0GGA7DMI7jsiywJUviOk+LJKreY0lJKFaAIAxDPepxUJEQhBCMEcbYAHfwnOf5dDpByKIoIX1ZVWEUaz1er9fL5XI+n0HgeR7nnBKC0KpcxXGSpGmaF0Vd1+v1ea6GoSjLqmk+brevx+P7+fy8333ftywLbcC/MCCTFIIz5joOnLJGZExQGlICR0viJYxGjDqOjV9gSOjxAEa5D7/IoJSMJJ5beU7NSE3c2rNr4niOjV7F1vG4EqHjH1oIH1ai/UZ4YPsf5x+/kVFOVrUgMAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Console output\"\n        title=\"\"\n        src=\"/static/b9a6bb2364ca5623003b30d2c722f06c/fb8a0/console-output.png\"\n        srcset=\"/static/b9a6bb2364ca5623003b30d2c722f06c/1a291/console-output.png 148w,\n/static/b9a6bb2364ca5623003b30d2c722f06c/2bc4a/console-output.png 295w,\n/static/b9a6bb2364ca5623003b30d2c722f06c/fb8a0/console-output.png 590w,\n/static/b9a6bb2364ca5623003b30d2c722f06c/526de/console-output.png 885w,\n/static/b9a6bb2364ca5623003b30d2c722f06c/fa2eb/console-output.png 1180w,\n/static/b9a6bb2364ca5623003b30d2c722f06c/08f6a/console-output.png 1770w,\n/static/b9a6bb2364ca5623003b30d2c722f06c/875ba/console-output.png 3266w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>You can create alias for simplify using (for macosx):</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">echo &quot;alias tank=\\&quot;docker run -v $(pwd):/var/loadtest -v $SSH_AUTH_SOCK:/ssh-agent -e SSH_AUTH_SOCK=/ssh-agent -v $HOME/.ssh:/root/.ssh --net host -it direvius/yandex-tank\\&quot;&quot; &gt;&gt; ~/.bash_profile &amp;&amp; source ~/.bash_profile</code></pre></div>\n<p>And using one:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">tank</code></pre></div>\n<h2>Visualizing Data</h2>\n<p>For visualize load metrics out of the box we can setup the <a href=\"https://overload.yandex.net/mainpage/guide#install\">Overload Beta</a> service:</p>\n<p>Example view of <code class=\"language-text\">Quantiles</code>:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1d2623c892938e659dff6e5dc392ee9b/5daa8/overload-quantiles.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.634590377113135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACGElEQVQoz5VRS2sTYRSd3+PelTtBpO+EhtgWCu5cCb42IqhYsVFpq2kqMUXbpgpKsBoULcUUkqBmIu2kiU0TQl5tE6dJ03l9M/PN9xpn6C/wclbnnnvv4R6ONKu0dUD3G0zu2f9TzLI4bcynX54EPg+KvmAORehpjzICCaTM5RghBCGKEbEsqKhQA3LrEOQEDox6jYlL+lA/fj3v7qOUYWyYoHK0V2wJQoXvdA6gonS77V63jQBApuHItI6oZTOc6vNo4355sA88fwwtaEgSUfVGqxLLhDfyS592oj9rSX6fT9UTeVEASK/3qiZD5ZoAsjzX8wxLfp8y2GcEZ4htO/acxZWT4tvt63Hhxkru9tqf5QgfWt2a+VBYbErVL8WPhU7+c2ZVTCc44B81Jid07zAMPcM2hch11ZAz8ezAesYbFsZf8ncebt56lLj6NHkzWVufS02/K7yJfL9XTqxx2sBF4B0CF86DwAPIpGOt6QyL0tfCjzOl9NlU+VxsxxvdHgn/6n+SHFnZmp5KXLm/eW0qPlbaeM8ZCyG4GDHng9q3OKaSDBqU2oaeU3bv6qWAIgbq7dn6cbD+d7bcntsVY8Lhq1RzKV1cONr7zQGEIMbYtiFz3owtC+kmkFRVBVA1dMtUNUlDwLBUAxz3iK6bso5PVGRhwmzuNBvbOcfcctNywibYDZci5gJTYjFKKEEOHN6CpglNR/wP/6b1RElFBDEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Overload Quantiles\"\n        title=\"\"\n        src=\"/static/1d2623c892938e659dff6e5dc392ee9b/fb8a0/overload-quantiles.png\"\n        srcset=\"/static/1d2623c892938e659dff6e5dc392ee9b/1a291/overload-quantiles.png 148w,\n/static/1d2623c892938e659dff6e5dc392ee9b/2bc4a/overload-quantiles.png 295w,\n/static/1d2623c892938e659dff6e5dc392ee9b/fb8a0/overload-quantiles.png 590w,\n/static/1d2623c892938e659dff6e5dc392ee9b/526de/overload-quantiles.png 885w,\n/static/1d2623c892938e659dff6e5dc392ee9b/fa2eb/overload-quantiles.png 1180w,\n/static/1d2623c892938e659dff6e5dc392ee9b/5daa8/overload-quantiles.png 1538w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Drawdowns towards the end of the test indicate a restart of the PODs, respectively, memory leaks or high consumption, followed by GC (Garbage Collector) cleaning.</p>\n<h2>Detecting memory leaks for <code class=\"language-text\">nodejs</code> apps</h2>\n<p><a href=\"https://github.com/Unitech/pm2\">pm2</a> is best Process Manager with a built-in Load Balancer. We can use <code class=\"language-text\">pm2</code> for monitoring memory using you <code class=\"language-text\">nodejs</code> apps.</p>\n<p>Usable tips:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">node_modules/pm2/bin/pm2 monit\nnode_modules/pm2/bin/pm2 imonit</code></pre></div>\n<p><code class=\"language-text\">Process List</code> is important section:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0ce027380578a5a9415fdb466efbf208/eb72d/pm2-process-list.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.82716049382716%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABfElEQVQoz21S0W6EIBDkNy4nCCoiKOKJorlc26d7atL2sf//JR3ZXHNJO9HNijvM7AK7x/eX9Xv1H9f5M41fKdzfRr+nNGUsy4IYM8ZxDCFMDzRNwyZdB62uRgUjBy1dKy523tKW0ppSmucZdaANw9C2LQha6yZDKcUKLgXHK4pCFJwXvJxMty9xulygBuVLBvjYhZRpBXsxKUB8Rjl2YVvTmgEyxFEKjnOue4KUkok/5ND5fV0hCxqkyLPLIBrlR89/yVM3bEuEGshkmwbmvccuPgNJVVX/kL2Z9rSRbfKMamstNNsMYwxiXdeMF+X5fOb8oOHhx8DMFueQh/yrTG3TqOYMDJ7B2u326txQYNBCat0uMaJRtIQ6iEBBZ9AJ5bTFW9WawT2KmqbmWV0pue87FvGJoyF7BKKiVZ4hypIhnk6nAqcsBK2iVVwPVI9DtJ0zGZDCrcDxyKM9frQnBMMPGgYliH3fY0KHz/rQUQ+AqGDE9ZW1lXO17X8AHtVzUomFSmAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Process List\"\n        title=\"\"\n        src=\"/static/0ce027380578a5a9415fdb466efbf208/fb8a0/pm2-process-list.png\"\n        srcset=\"/static/0ce027380578a5a9415fdb466efbf208/1a291/pm2-process-list.png 148w,\n/static/0ce027380578a5a9415fdb466efbf208/2bc4a/pm2-process-list.png 295w,\n/static/0ce027380578a5a9415fdb466efbf208/fb8a0/pm2-process-list.png 590w,\n/static/0ce027380578a5a9415fdb466efbf208/526de/pm2-process-list.png 885w,\n/static/0ce027380578a5a9415fdb466efbf208/fa2eb/pm2-process-list.png 1180w,\n/static/0ce027380578a5a9415fdb466efbf208/08f6a/pm2-process-list.png 1770w,\n/static/0ce027380578a5a9415fdb466efbf208/eb72d/pm2-process-list.png 3240w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>","frontmatter":{"title":"Yandex Tank Benchmark setup and Overlod analisis","date":"January 24, 2019"}}},"pageContext":{"slug":"/yandex-tank-benchmark/","previous":{"fields":{"slug":"/pwa-icon-to-home/"},"frontmatter":{"title":"Add a PWA icon to home screen"}},"next":null}}